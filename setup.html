
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="configuration.html">
      
      
        <link rel="next" href="security.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>Setup - GitHub Self-Hosted AWS Runners</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="GitHub Self-Hosted AWS Runners" class="md-header__button md-logo" aria-label="GitHub Self-Hosted AWS Runners" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GitHub Self-Hosted AWS Runners
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setup
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/philips-labs/terraform-aws-github-runner" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    philips-labs/terraform-aws-github-runner
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="GitHub Self-Hosted AWS Runners" class="md-nav__button md-logo" aria-label="GitHub Self-Hosted AWS Runners" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    GitHub Self-Hosted AWS Runners
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/philips-labs/terraform-aws-github-runner" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    philips-labs/terraform-aws-github-runner
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduciton
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="configuration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Setup
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="setup.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#required-rools" class="md-nav__link">
    <span class="md-ellipsis">
      Required rools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Setup guide
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-github-app-part-1" class="md-nav__link">
    <span class="md-ellipsis">
      Setup GitHub App (part 1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-terraform-module" class="md-nav__link">
    <span class="md-ellipsis">
      Setup terraform module
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup terraform module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-lambdas" class="md-nav__link">
    <span class="md-ellipsis">
      Download lambdas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-linked-role" class="md-nav__link">
    <span class="md-ellipsis">
      Service-linked role
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-module" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform module
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-the-webhook-github-app-part-2" class="md-nav__link">
    <span class="md-ellipsis">
      Setup the webhook / GitHub App (part 2)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup the webhook / GitHub App (part 2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      Option 1: Webhook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-app" class="md-nav__link">
    <span class="md-ellipsis">
      Option 2: App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-github-app" class="md-nav__link">
    <span class="md-ellipsis">
      Install GitHub app
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="security.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="modules/runners.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Runners (root)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/modules/public/multi-runner.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi Runners
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/modules/public/ami-housekeeper.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMI Housekeeper
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/modules/public/download-lambda.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda Downloader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Internal
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Internal
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/modules/internal/runners.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Runner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/modules/internal/runner-binaries-syncer.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Syncer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/modules/internal/ssm.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/modules/internal/webhook.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webhook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/modules/internal/webhook-github-app.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webhooik GitHub App:
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="examples.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Oeverview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="default.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Default
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/examples/multi-runner.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/examples/ephemeral.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ephemeral
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/examples/arm64.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/examples/ubuntu.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ARM64
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/examples/windows.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/examples/prebuilt.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom AMI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/examples/lambdas-download.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda download
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generated/examples/permissions-boundary.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Permissions boundary
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#required-rools" class="md-nav__link">
    <span class="md-ellipsis">
      Required rools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Setup guide
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-github-app-part-1" class="md-nav__link">
    <span class="md-ellipsis">
      Setup GitHub App (part 1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-terraform-module" class="md-nav__link">
    <span class="md-ellipsis">
      Setup terraform module
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup terraform module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-lambdas" class="md-nav__link">
    <span class="md-ellipsis">
      Download lambdas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-linked-role" class="md-nav__link">
    <span class="md-ellipsis">
      Service-linked role
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-module" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform module
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-the-webhook-github-app-part-2" class="md-nav__link">
    <span class="md-ellipsis">
      Setup the webhook / GitHub App (part 2)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup the webhook / GitHub App (part 2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-webhook" class="md-nav__link">
    <span class="md-ellipsis">
      Option 1: Webhook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-app" class="md-nav__link">
    <span class="md-ellipsis">
      Option 2: App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-github-app" class="md-nav__link">
    <span class="md-ellipsis">
      Install GitHub app
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/philips-labs/terraform-aws-github-runner/edit/npalm/mkdocs/docs/setup.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="setup">Setup</h1>
<p>Terraform examples are availabile for different use-cases for example multiple runners, ephemeral runners, and windows. For more details see the <a href="../examples">examplees</a>.</p>
<p>The module supports two main scenarios for creating runners. Repository level runners will be dedicated to only one repository, no other repository can use the runner. At the organization level you can use the runner(s) for all repositories within the organization. See <a href="https://help.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners">GitHub self-hosted runner instructions</a> for more information. Before starting the deployment you have to choose one option.</p>
<p>The setup guide below is a generic direction. There are many choices you can make, and there is no right way. For example we deploy ephemeral runners for both Linux and WIndows with packer pre-bult AMI's that are automatically updated. Deployment is done with GitHub actions, Terragrunt and terraform. The lamba's we sync to AWS S3. For the major fleet we have a tiny pool to let start jobs quickly.</p>
<h2 id="required-rools">Required rools</h2>
<p>The following tools are a minimum rqquirement. We advise to deploy the stack via a CI/CD pipeline.</p>
<ul>
<li>Terraform</li>
<li>Bash shell or compatible</li>
<li>Docker (optional, to build lambdas without node).</li>
<li>AWS cli (optional)</li>
<li>Node and yarn to build the Lambda's (or download via Release).</li>
</ul>
<h2 id="setup-guide">Setup guide</h2>
<p>The setup consists of running Terraform to create all AWS resources and manually configuring the GitHub App. The Terraform module requires configuration from the GitHub App and the GitHub app requires output from Terraform. Therefore you first create the GitHub App and configure the basics, then run Terraform, and afterwards finalize the configuration of the GitHub App.</p>
<h3 id="setup-github-app-part-1">Setup GitHub App (part 1)</h3>
<p>Go to GitHub and <a href="https://docs.github.com/en/developers/apps/creating-a-github-app">create a new app</a>. Be aware you can create apps for your organization or for a user. For now we only support organization level apps.</p>
<ol>
<li>Create an app in Github</li>
<li>Choose a name</li>
<li>Choose a website (mandatory, not required for the module).</li>
<li>Disable the webhook for now (we will configure this later or create an alternative webhook).</li>
<li>Permissions for all runners:<ul>
<li>Repository:</li>
<li><code>Actions</code>: Read-only (check for queued jobs)</li>
<li><code>Checks</code>: Read-only (receive events for new builds)</li>
<li><code>Metadata</code>: Read-only (default/required)</li>
</ul>
</li>
<li><em>Permissions for repo level runners only</em>:</li>
<li>Repository:<ul>
<li><code>Administration</code>: Read &amp; write (to register runner)</li>
</ul>
</li>
<li><em>Permissions for organization level runners only</em>:</li>
<li>Organization<ul>
<li><code>Self-hosted runners</code>: Read &amp; write (to register runner)</li>
</ul>
</li>
<li>Save the new app.</li>
<li>On the General page, make a note of the "App ID" and "Client ID" parameters.</li>
<li>Generate a new private key and save the <code>app.private-key.pem</code> file.</li>
</ol>
<h3 id="setup-terraform-module">Setup terraform module</h3>
<h4 id="download-lambdas">Download lambdas</h4>
<p>To apply the terraform module, the compiled lambdas (.zip files) need to be available either locally or in an S3 bucket. They can either be downloaded from the GitHub release page or built locally.</p>
<p>To read the files from S3, set the <code>lambda_s3_bucket</code> variable and the specific object key for each lambda.</p>
<p>The lambdas can be downloaded manually from the <a href="https://github.com/philips-labs/terraform-aws-github-runner/releases">release page</a> or using the <a href="./modules/download-lambda">download-lambda</a> terraform module (requires <code>curl</code> to be installed on your machine). In the <code>download-lambda</code> directory, run <code>terraform init &amp;&amp; terraform apply</code>. The lambdas will be saved to the same directory.</p>
<p>For local development you can build all the lambdas at once using <code>.ci/build.sh</code> or individually using <code>yarn dist</code>.</p>
<h4 id="service-linked-role">Service-linked role</h4>
<p>To create spot instances the <code>AWSServiceRoleForEC2Spot</code> role needs to be added to your account. You can do that manually by following the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-requests.html#service-linked-roles-spot-instance-requests">AWS docs</a>. To use terraform for creating the role, either add the following resource or let the module manage the service linked role by setting <code>create_service_linked_role_spot</code> to <code>true</code>. Be aware this is an account global role, so maybe you don't want to manage it via a specific deployment.</p>
<pre><code class="language-hcl">resource &quot;aws_iam_service_linked_role&quot; &quot;spot&quot; {
  aws_service_name = &quot;spot.amazonaws.com&quot;
}
</code></pre>
<h4 id="terraform-module">Terraform module</h4>
<p>Next create a second terraform workspace and initiate the module, or adapt one of the <a href="../examples">examples</a>.</p>
<p>Note that <code>github_app.key_base64</code> needs to be a base64-encoded string of the <code>.pem</code> file i.e. the output of <code>base64 app.private-key.pem</code>. The decoded string can either be a multiline value or a single line value with new lines represented with literal <code>\n</code> characters.</p>
<pre><code class="language-hcl">module &quot;github-runner&quot; {
  source  = &quot;philips-labs/github-runner/aws&quot;
  version = &quot;REPLACE_WITH_VERSION&quot;

  aws_region = &quot;eu-west-1&quot;
  vpc_id     = &quot;vpc-123&quot;
  subnet_ids = [&quot;subnet-123&quot;, &quot;subnet-456&quot;]

  prefix = &quot;gh-ci&quot;

  github_app = {
    key_base64     = &quot;base64string&quot;
    id             = &quot;1&quot;
    webhook_secret = &quot;webhook_secret&quot;
  }

  webhook_lambda_zip                = &quot;lambdas-download/webhook.zip&quot;
  runner_binaries_syncer_lambda_zip = &quot;lambdas-download/runner-binaries-syncer.zip&quot;
  runners_lambda_zip                = &quot;lambdas-download/runners.zip&quot;
  enable_organization_runners = true
}
</code></pre>
<p>Run terraform by using the following commands</p>
<pre><code class="language-bash">terraform init
terraform apply
</code></pre>
<p>The terraform output displays the API gateway url (endpoint) and secret, which you need in the next step.</p>
<p>The lambda for syncing the GitHub distribution to S3 is triggered via CloudWatch (by default once per hour). After deployment the function is triggered via S3 to ensure the distribution is cached.</p>
<h3 id="setup-the-webhook-github-app-part-2">Setup the webhook / GitHub App (part 2)</h3>
<p>At this point you have two options. Either create a separate webhook (enterprise,
org, or repo), or create a webhook in the App.</p>
<h4 id="option-1-webhook">Option 1: Webhook</h4>
<ol>
<li>Create a new webhook at the repo level for repo level runners, or org (or enterprise level) for org level runners.</li>
<li>Provide the webhook url, which should be part of the output of terraform.</li>
<li>Provide the webhook secret (<code>terraform output -raw &lt;NAME_OUTPUT_VAR&gt;</code>).</li>
<li>Ensure the content type is <code>application/json</code>.</li>
<li>In the "Permissions &amp; Events" section and then "Subscribe to Events" subsection, check either "Workflow Job" or "Check Run" (choose only one option!!!).</li>
<li>In the "Install App" section, install the App in your organization, either in all or in selected repositories.</li>
</ol>
<h4 id="option-2-app">Option 2: App</h4>
<p>Go back to the GitHub App and update the following settings.</p>
<ol>
<li>Enable the webhook.</li>
<li>Provide the webhook url, should be part of the output of terraform.</li>
<li>Provide the webhook secret (<code>terraform output -raw &lt;NAME_OUTPUT_VAR&gt;</code>).</li>
<li>In the "Permissions &amp; Events" section and then "Subscribe to Events" subsection, check either "Workflow Job" or "Check Run" (choose only one option!!!).</li>
</ol>
<h4 id="install-github-app">Install GitHub app</h4>
<p>Finally you need to ensure the app is installed to all or selected repositories.</p>
<p>Go back to the GitHub App and update the following settings.</p>
<ol>
<li>In the "Install App" section, install the App in your organization, either in all or in selected repositories.</li>
</ol>
<h2 id="debugging">Debugging</h2>
<p>In case the setup does not work as intended follow the trace of events:</p>
<ul>
<li>In the GitHub App configuration, the Advanced page displays all webhook events that were sent.</li>
<li>In AWS CloudWatch, every lambda has a log group. Look at the logs of the <code>webhook</code> and <code>scale-up</code> lambdas.</li>
<li>In AWS SQS you can see messages available or in flight.</li>
<li>Once an EC2 instance is running, you can connect to it in the EC2 user interface using Session Manager (use <code>enable_ssm_on_runners = true</code>). Check the user data script using <code>cat /var/log/user-data.log</code>. By default several log files of the instances are streamed to AWS CloudWatch, look for a log group named <code>&lt;environment&gt;/runners</code>. In the log group you should see at least the log streams for the user data installation and runner agent.</li>
<li>Registered instances should show up in the Settings - Actions page of the repository or organization (depending on the installation mode).</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["content.code.copy", "content.action.edit", "navigation.instant", "navigation.instant.progress", "navigation.tracking", "pymdownx.snippets"], "search": "assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>